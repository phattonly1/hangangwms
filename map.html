<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>수질측정망 지도 · Android Whale 안정판</title>
<link rel="icon" href="./assets/gongdan-mark.png" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<style>
  :root{
    --hdr:56px; --gap:12px;
    /* safe-area: Android Whale에선 0 이어도 OK */
    --sa-t: env(safe-area-inset-top, 0px);
    --sa-r: env(safe-area-inset-right, 0px);
    --sa-b: env(safe-area-inset-bottom, 0px);
    --sa-l: env(safe-area-inset-left, 0px);
    --ui-sz: 56px; /* GPS 같은 플로팅 버튼 크기 기준 */
  }

  /* 폰트 16px 이상으로 포커스 줌 방지 (Chromium) */
  html{ -webkit-text-size-adjust:100%; }
  input, select, button{ font-size:16px; }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,Apple SD Gothic Neo,Pretendard,Segoe UI,Roboto,Arial}
  body{background:#0b1622;color:#e6eef6}

  /* 헤더 */
  .appbar{
    position:sticky;top:0;z-index:10;height:var(--hdr);
    padding:0 calc(var(--gap)+var(--sa-r)) 0 calc(var(--gap)+var(--sa-l));
    display:flex;align-items:center;gap:10px;background:#101b2a;border-bottom:1px solid rgba(255,255,255,.08)
  }
  .title{font-weight:800;letter-spacing:-.02em}

  /* 지도: 100svh로 주소창 변동 대응 */
  .wrap{
    position:relative;
    height: calc(100svh - var(--hdr));
    min-height: 420px;
  }
  #map{width:100%;height:100%}

  /* ====== UI 오버레이: Android에선 fixed가 가장 안정적 ====== */
  /* 좌상단 패널(icons + 필터 + 드롭다운) */
  .panel{
    position:fixed; z-index:1100;
    left: calc(var(--gap) + var(--sa-l));
    top:  calc(var(--gap) + var(--sa-t));
    background:rgba(16,27,42,.96); color:#e6eef6;
    border:1px solid rgba(255,255,255,.1);
    border-radius:14px; padding:8px 10px;
    display:flex; align-items:center; gap:10px;
    max-width: min(92vw, 360px);
  }
  .panel .icon{
    width:36px; height:36px; border:none; border-radius:10px;
    background:transparent; color:#e6eef6; display:grid; place-items:center; cursor:pointer
  }
  .panel .group{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
  .panel label{ display:flex; align-items:center; gap:8px; font-size:16px; line-height:1 }
  .panel input[type="checkbox"]{
    width:18px; height:18px; accent-color:#4da3ff;
  }
  .panel select{
    border:1px solid #334155; background:#0f1725; color:#e6eef6;
    border-radius:10px; padding:8px 10px; font-size:16px; max-width:min(60vw,260px)
  }

  /* 우상단: Leaflet 줌은 컨트롤 자체 위치 + 마진으로 세이프존 */
  .leaflet-control-container .leaflet-top.leaflet-right{
    margin-top: calc(var(--gap) + var(--sa-t));
    margin-right: calc(var(--gap) + var(--sa-r));
  }
  /* 우하단: 레이어 스위처는 GPS 위에 겹치지 않게 오프셋 */
  .leaflet-control-container .leaflet-bottom.leaflet-right{
    margin-right: calc(var(--gap) + var(--sa-r));
    margin-bottom: calc(var(--ui-sz) + 28px + var(--sa-b));
  }
  .leaflet-control{box-shadow:0 2px 8px rgba(0,0,0,.4)!important;border-radius:12px!important}
  .leaflet-control a{border-radius:12px!important}

  /* 우하단 GPS: fixed로 뷰포트 하단 고정 */
  .gps{
    position:fixed; z-index:1200;
    right: calc(var(--gap) + var(--sa-r));
    bottom: calc(20px + var(--sa-b));
    width: var(--ui-sz);
