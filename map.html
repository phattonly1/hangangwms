<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>ìˆ˜ì§ˆì¸¡ì •ë§ ì§€ë„</title>
<link rel="icon" href="./assets/gongdan-mark.png" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
  /* [í…Œë§ˆ ë³€ìˆ˜] */
  :root {
    --hdr: 60px; --gap: 20px; /* ì—¬ë°±ì„ ì¡°ê¸ˆ ë” ë„‰ë„‰í•˜ê²Œ */
    --btn-size: 48px; /* ë²„íŠ¼ í¬ê¸° í†µì¼ */
    --sa-t: env(safe-area-inset-top, 0px);
    --sa-r: env(safe-area-inset-right, 0px);
    --sa-b: env(safe-area-inset-bottom, 0px);
    
    /* Light Mode (ë°˜íˆ¬ëª… ì ìš©) */
    /* ë°°ê²½ìƒ‰ íˆ¬ëª…ë„ 0.25ë¡œ ë‚®ì¶¤ + ë¸”ëŸ¬ íš¨ê³¼ ê°•í™” */
    --bg: #e6f4ff; --text: #0b2239; 
    --glass-bg: rgba(255, 255, 255, 0.25); 
    --glass-border: rgba(255, 255, 255, 0.4);
    --shadow: 0 8px 32px rgba(31, 38, 135, 0.15); /* ìœ ë¦¬ ëŠë‚Œ ê·¸ë¦¼ì */
    --primary: #0ea5e9; 
    --input-bg: rgba(255, 255, 255, 0.9);
  }
  
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #0b1622; --text: #e6eef6; 
      --glass-bg: rgba(22, 32, 50, 0.25);
      --glass-border: rgba(255, 255, 255, 0.1);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --primary: #38bdf8; 
      --input-bg: rgba(22, 32, 50, 0.9);
    }
  }

  html,body{height:100%;margin:0;font-family:-apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;}
  body{background:var(--bg);color:var(--text); touch-action: manipulation;}
  
  /* í—¤ë” (ë°˜íˆ¬ëª…) */
  .appbar {
    position: sticky; top: 0; z-index: 1000; height: var(--hdr);
    padding: var(--sa-t) var(--gap) 0 var(--gap);
    display: flex; align-items: center; gap: 10px;
    background: var(--glass-bg); backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--glass-border); 
  }
  .title { font-weight: 800; font-size: 18px; letter-spacing: -0.02em; color: var(--text); }

  /* ì§€ë„ ì˜ì—­ */
  .wrap { position: relative; height: calc(100svh - var(--hdr) - var(--sa-t)); }
  #map { width: 100%; height: 100%; background: #ddd; z-index: 1; }

  /* --- [ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ì •ë ¬ ìˆ˜ì •] --- */
  .dock-container {
    position: fixed; z-index: 1200;
    /* ìš°ì¸¡ í•˜ë‹¨ ì—¬ë°± í†µì¼ */
    right: calc(var(--gap) + var(--sa-r));
    bottom: calc(var(--gap) + var(--sa-b));
    display: flex; flex-direction: column; 
    align-items: center; /* ì¤‘ì•™ ì •ë ¬ë¡œ ë²„íŠ¼ ì¤‘ì‹¬ì„  ë§ì¶¤ */
    gap: 16px; /* ìƒí•˜ ê·¸ë£¹ ê°„ê²© */
  }

  /* 1. ì§€ë„ ì»¨íŠ¸ë¡¤ ê·¸ë£¹ (í™•ëŒ€/ì¶•ì†Œ/ë ˆì´ì–´) */
  .map-controls {
    display: flex; flex-direction: column; gap: 8px;
    background: var(--glass-bg); 
    padding: 6px; 
    border-radius: 99px; /* ì•Œì•½ ëª¨ì–‘ */
    border: 1px solid var(--glass-border);
    box-shadow: var(--shadow); 
    backdrop-filter: blur(12px); /* ë¸”ëŸ¬ íš¨ê³¼ */
    -webkit-backdrop-filter: blur(12px);
  }

  /* 2. ì•± ë„êµ¬ ê·¸ë£¹ (ê²€ìƒ‰/GPS) */
  .app-tools {
    display: flex; flex-direction: column; gap: 12px;
  }

  /* ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .btn {
    width: var(--btn-size); height: var(--btn-size);
    display: grid; place-items: center;
    border: none; border-radius: 50%; cursor: pointer;
    color: var(--text); font-size: 22px; 
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
    background: transparent; /* ê¸°ë³¸ ë°°ê²½ íˆ¬ëª… (ê·¸ë£¹ ë‚´ ë²„íŠ¼ìš©) */
    position: relative;
  }
  
  /* ì•± ë„êµ¬ ë²„íŠ¼ (ë…ë¦½í˜•) - ë°˜íˆ¬ëª… ë°°ê²½ ì ìš© */
  .app-tools .btn {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    box-shadow: var(--shadow);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .btn:active { transform: scale(0.92); }
  .map-controls .btn:hover { background: rgba(125,125,125,0.1); }
  
  /* êµ¬ë¶„ì„  */
  .divider { height: 1px; background: var(--glass-border); width: 24px; margin: 0 auto; }

  /* GPS í™œì„±í™” ìŠ¤íƒ€ì¼ */
  .app-tools .btn.active { 
    background: var(--primary); color: #fff; border-color: transparent;
    box-shadow: 0 0 15px rgba(14, 165, 233, 0.4);
  }
  .btn.tracking i { animation: pulse 2s infinite; }
  @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1); } }

  /* íŒ¨ë„ ìŠ¤íƒ€ì¼ (ë°˜íˆ¬ëª…) */
  .panel {
    position: fixed; z-index: 1250;
    right: calc(var(--gap) + var(--sa-r));
    /* ë„í‚¹ ë²„íŠ¼ë“¤ ë†’ì´ì— ë§ì¶° ìœ„ì¹˜ ê³„ì‚° */
    bottom: calc(var(--gap) + var(--sa-b) + 240px); 
    background: var(--glass-bg); color: var(--text);
    border: 1px solid var(--glass-border); border-radius: 20px;
    padding: 20px; width: 300px; max-width: 88vw;
    display: flex; flex-direction: column; gap: 16px;
    box-shadow: var(--shadow); 
    backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s;
    transform-origin: bottom right;
  }
  .panel.collapsed { transform: scale(0.9) translateY(20px); opacity: 0; pointer-events: none; }
  
  /* í•„í„° ì¹© */
  .group.filters { display: flex; gap: 8px; flex-wrap: wrap; }
  .filter-chip input { display: none; }
  .filter-chip span {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 8px 14px; border-radius: 99px;
    background: var(--input-bg); border: 1px solid var(--glass-border); color: var(--text);
    font-size: 13px; font-weight: 600; cursor: pointer;
    transition: all 0.2s; user-select: none;
  }
  .filter-chip input:checked + span {
    background: var(--primary); color: white; border-color: transparent;
    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
  }

  /* ê²€ìƒ‰ì°½ */
  .search-box { position: relative; width: 100%; }
  .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text); opacity: 0.5; pointer-events: none; }
  #searchInput {
    width: 100%; padding: 12px 12px 12px 40px; 
    border: 1px solid var(--glass-border);
    border-radius: 12px; background: var(--input-bg); color: var(--text);
    font-size: 15px; outline: none; transition: border-color .2s;
    appearance: none;
  }
  #searchInput:focus { border-color: var(--primary); }
  
  .result-list {
    position: absolute; bottom: 100%; left: 0; right: 0;
    margin: 0 0 8px 0; padding: 0; list-style: none;
    max-height: 240px; overflow-y: auto;
    background: var(--input-bg); border: 1px solid var(--glass-border);
    border-radius: 12px; box-shadow: var(--shadow);
    display: none; z-index: 1300;
  }
  .result-list.show { display: block; }
  .result-list li {
    padding: 12px 14px; border-bottom: 1px solid var(--glass-border);
    cursor: pointer; font-size: 14px; color: var(--text); display: flex; align-items: center; gap: 8px;
  }
  .result-list li:hover { background: rgba(0,0,0,0.05); color: var(--primary); }
  @media (prefers-color-scheme: dark) { .result-list li:hover { background: rgba(255,255,255,0.1); } }

  /* íŒì—… ì»¤ìŠ¤í…€ */
  .leaflet-popup-content-wrapper, .leaflet-popup-tip {
    background: var(--glass-bg); color: var(--text);
    backdrop-filter: blur(12px); box-shadow: var(--shadow); border: 1px solid var(--glass-border);
  }
  .leaflet-popup-content { margin: 16px; line-height: 1.5; }
  .leaflet-container a.leaflet-popup-close-button { color: var(--text); font-size: 18px; }

  .toast { position: fixed; z-index: 2000; left: 50%; transform: translateX(-50%); bottom: 100px; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); color: #fff; border-radius: 30px; padding: 12px 24px; font-size: 14px; opacity: 0; pointer-events: none; transition: opacity .2s; font-weight: 600; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .toast.show { opacity: 1; }
</style>
</head>
<body>
  <header class="appbar"><div class="title">ìˆ˜ì§ˆì¸¡ì •ë§ ì§€ë„</div></header>

  <main class="wrap">
    <div id="map" role="region" aria-label="ì§€ë„"></div>

    <div class="dock-container">
      
      <div class="map-controls">
        <button class="btn" id="layerBtn" title="ì§€ë„ ë°°ê²½ ë³€ê²½"><i class="ph-bold ph-stack"></i></button>
        <div class="divider"></div>
        <button class="btn" onclick="map.zoomIn()" title="í™•ëŒ€"><i class="ph-bold ph-plus"></i></button>
        <button class="btn" onclick="map.zoomOut()" title="ì¶•ì†Œ"><i class="ph-bold ph-minus"></i></button>
      </div>

      <div class="app-tools">
        <button class="btn" id="panelToggle" aria-label="ê²€ìƒ‰ ë° í•„í„°"><i class="ph-bold ph-magnifying-glass"></i></button>
        <button class="btn" id="gpsBtn" aria-label="ë‚´ ìœ„ì¹˜"><i class="ph-bold ph-crosshair"></i></button>
      </div>

    </div>

    <div class="panel collapsed" id="panel">
      <div class="group filters">
        <label class="filter-chip"><input type="checkbox" id="showSmall" checked><span>ì†Œê·œëª¨</span></label>
        <label class="filter-chip"><input type="checkbox" id="showStream" checked><span>í•˜ì²œ</span></label>
        <label class="filter-chip"><input type="checkbox" id="showStation" checked><span>ì¸¡ì •ì†Œ</span></label>
      </div>
      <div class="search-box">
        <i class="ph-bold ph-magnifying-glass search-icon"></i>
        <input type="text" id="searchInput" placeholder="ì¸¡ì •ì†Œ ê²€ìƒ‰..." autocomplete="off">
        <ul id="searchResult" class="result-list"></ul>
      </div>
    </div>

    <div class="toast" id="toast"><i class="ph-fill ph-info"></i> <span>ì•Œë¦¼</span></div>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  
  <script>
  addEventListener('error', e=>{});

  /* ì§€ë„ ì„¤ì • */
  const layers = {
    carto: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{attribution:'&copy; CARTO', maxZoom: 19}),
    satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {attribution: '&copy; Esri', maxZoom: 18})
  };

  const map = L.map('map', { zoomControl:false, preferCanvas:true, layers: [layers.carto] });
  map.setView([37.5665,126.9780], 11);

  /* ë ˆì´ì–´ í† ê¸€ */
  let isSatellite = false;
  document.getElementById('layerBtn').addEventListener('click', function() {
    if(isSatellite) {
      map.removeLayer(layers.satellite); map.addLayer(layers.carto);
      this.style.color = 'var(--text)';
      toast('ê¸°ë³¸ ì§€ë„ë¡œ ë³€ê²½');
    } else {
      map.removeLayer(layers.carto); map.addLayer(layers.satellite);
      this.style.color = 'var(--primary)';
      toast('ìœ„ì„± ì§€ë„ë¡œ ë³€ê²½');
    }
    isSatellite = !isSatellite;
  });

  /* ë ˆì´ì•„ì›ƒ ìë™ ì¡°ì • */
  function updateLayout(){
    const dock = document.querySelector('.dock-container');
    const panel = document.querySelector('.panel');
    if(dock && panel) {
       const dockHeight = dock.offsetHeight;
       const bottomSafe = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sa-b'))||0;
       // íŒ¨ë„ ìœ„ì¹˜: ë„í‚¹ ë²„íŠ¼ ìœ„ìª½ + ì—¬ë°±
       panel.style.bottom = (dockHeight + 20 + 20 + bottomSafe) + 'px';
    }
  }
  addEventListener('load', updateLayout);
  addEventListener('resize', updateLayout);
  
  const toast = (m,ms=1500)=>{ const t=document.getElementById('toast'); t.querySelector('span').textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),ms); };

  /* ë°ì´í„° ì†ŒìŠ¤ */
  const GIST = { user:'phattonly1', id:'9309e6ef4dd423e20628a28512edf12b', commit:'7452906127b85ad19f156d19de04141b49885411', file:'facilities.json' };
  const DATA_URLS = [
    `https://gist.githubusercontent.com/${GIST.user}/${GIST.id}/raw/${GIST.commit}/${GIST.file}`,
    `https://gistcdn.githack.com/${GIST.user}/${GIST.id}/raw/${GIST.commit}/${GIST.file}`
  ];

  /* ìƒíƒœ ë³€ìˆ˜ */
  const panelEl = document.getElementById('panel');
  const panelToggleBtn = document.getElementById('panelToggle');
  const searchInput = document.getElementById('searchInput');
  const searchResult = document.getElementById('searchResult');
  
  const typeOn = { small:true, stream:true, station:true };
  const typeStyle = {
    station:{ fill:'#2563eb', radius:8 },
    small:  { fill:'#0ea5e9', radius:9 },
    stream: { fill:'#3b82f6', radius:11 },
    default:{ fill:'#64748b', radius:8 }
  };
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);
  const tipOpt = isMobile ? {permanent:false} : {permanent:true, className:'station-tooltip', direction:'top', offset:[0,-10]};
  
  let items = [];
  const cluster = L.markerClusterGroup({ maxClusterRadius:40, showCoverageOnHover:false });

  /* íŒ¨ë„ í† ê¸€ */
  function setPanelCollapsed(collapsed){
    panelEl.classList.toggle('collapsed', collapsed);
    panelToggleBtn.innerHTML = collapsed ? '<i class="ph-bold ph-magnifying-glass"></i>' : '<i class="ph-bold ph-x"></i>';
    if(!collapsed) { setTimeout(()=> searchInput.focus(), 150); updateLayout(); }
  }
  addEventListener('load', ()=> setPanelCollapsed(true));
  panelToggleBtn.addEventListener('click', ()=> setPanelCollapsed(!panelEl.classList.contains('collapsed')));

  /* ë§ˆì»¤ */
  function mkMarker(f){
    const st = typeStyle[f.type] || typeStyle.default;
    const m = L.circleMarker([+f.lat, +f.lng], {
      radius: st.radius, color:'#fff', weight:2,
      fillColor: f.color || st.fill, fillOpacity:1.0
    }).bindTooltip(f.name, tipOpt);

    const naviUrl = `https://map.naver.com/v5/search/${encodeURIComponent(f.name)}?c=${f.lng},${f.lat},15,0,0,0,dh`;
    const kakaoUrl = `https://map.kakao.com/link/to/${encodeURIComponent(f.name)},${f.lat},${f.lng}`;

    const popupContent = `
      <div style="min-width:200px;">
        <h3 style="margin:0 0 6px; font-size:16px; font-weight:700; color:var(--primary); display:flex; align-items:center; gap:6px;">
          <i class="ph-fill ph-map-pin"></i> ${f.name}
        </h3>
        <div style="color:var(--text); opacity:0.8; font-size:13px; margin-bottom:12px;">
          ${f.id ? `ID: ${f.id} Â· ` : ''}${f.type}
        </div>
        <div style="display:flex; gap:8px;">
          <a href="${naviUrl}" target="_blank" style="flex:1; display:flex; align-items:center; justify-content:center; gap:4px; padding:8px 0; border-radius:8px; text-decoration:none; background:#03C75A; color:#fff; font-size:13px; font-weight:600;">N ë„¤ì´ë²„ì§€ë„</a>
          <a href="${kakaoUrl}" target="_blank" style="flex:1; display:flex; align-items:center; justify-content:center; gap:4px; padding:8px 0; border-radius:8px; text-decoration:none; background:#FEE500; color:#191919; font-size:13px; font-weight:600;">K ì¹´ì¹´ì˜¤ë§µ</a>
        </div>
      </div>
    `;
    m.bindPopup(popupContent);
    return m;
  }

  /* ë Œë”ë§ */
  function renderAll(){
    cluster.clearLayers();
    const filtered = items.filter(it => (typeOn[it.type] ?? true));
    filtered.forEach(it => cluster.addLayer(it.layer));
    if (!map.hasLayer(cluster)) map.addLayer(cluster);
    if (filtered.length > 0){
      try {
        const group = L.featureGroup(filtered.map(x=>x.layer));
        map.fitBounds(group.getBounds().pad(0.1), { animate: true, duration: 0.5 });
      } catch(e){}
    }
  }

  /* ê²€ìƒ‰ */
  function updateSearchList(keyword = '') {
    searchResult.innerHTML = '';
    const term = keyword.trim();
    if(!term) { searchResult.classList.remove('show'); return; }

    const filtered = items.filter(it => (typeOn[it.type] ?? true));
    const matched = filtered.filter(it => it.f.name.toLowerCase().includes(term.toLowerCase()));

    if(matched.length === 0) {
      const li = document.createElement('li');
      li.innerHTML = '<i class="ph ph-warning-circle"></i> ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
      li.style.color = 'var(--text)'; li.style.opacity = '0.7';
      searchResult.appendChild(li);
    } else {
      matched.sort((a,b)=> a.f.name.localeCompare(b.f.name,'ko')).forEach(it => {
        const li = document.createElement('li');
        li.innerHTML = `<i class="ph-bold ph-map-pin" style="color:var(--primary)"></i> ${it.f.name}`;
        li.onclick = () => {
           map.flyTo([it.f.lat, it.f.lng], 16, {duration: 0.8});
           setTimeout(()=> { cluster.zoomToShowLayer(it.layer, () => it.layer.openPopup()); }, 800);
           searchResult.classList.remove('show');
           searchInput.value = it.f.name;
           setPanelCollapsed(true);
        };
        searchResult.appendChild(li);
      });
    }
    searchResult.classList.add('show');
  }

  ['showSmall','showStream','showStation'].forEach(id=>{
    document.getElementById(id).addEventListener('change', ()=>{
      typeOn.small   = document.getElementById('showSmall').checked;
      typeOn.stream  = document.getElementById('showStream').checked;
      typeOn.station = document.getElementById('showStation').checked;
      renderAll();
      searchInput.value = ''; searchResult.classList.remove('show');
    });
  });

  searchInput.addEventListener('input', e => updateSearchList(e.target.value));
  searchInput.addEventListener('focus', () => { if(searchInput.value) updateSearchList(searchInput.value); });
  document.addEventListener('click', e => { if(!e.target.closest('.search-box')) searchResult.classList.remove('show'); });

  /* ë°ì´í„° ë¡œë“œ */
  async function loadFacilities(){
    for (const url of DATA_URLS){
      try{
        const r = await fetch(url, {cache:'no-store'});
        if(!r.ok) continue;
        const text = await r.text();
        let json;
        try{ json = JSON.parse(text); } catch{ const s=text.indexOf('['), e=text.lastIndexOf(']'); json = JSON.parse(text.slice(s,e+1)); }
        if(!Array.isArray(json)) continue;
        items = json.map(f=>({ f, type: f.type||'default', layer: mkMarker(f) }));
        renderAll();
        toast('ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        return;
      } catch(err){ console.warn(err); }
    }
    toast('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
  }

  /* GPS */
  let me=null, watchId=null, tracking=false;
  const gpsBtn = document.getElementById('gpsBtn');
  
  gpsBtn.addEventListener('click', ()=>{
    if (tracking){
      navigator.geolocation?.clearWatch?.(watchId);
      tracking=false; 
      gpsBtn.classList.remove('active', 'tracking');
      gpsBtn.innerHTML = '<i class="ph-bold ph-crosshair"></i>';
      if (me){ map.removeLayer(me); me=null; }
      toast('ìœ„ì¹˜ ì¶”ì  ì¢…ë£Œ');
      return;
    }
    if (!navigator.geolocation){ toast('ìœ„ì¹˜ ë¯¸ì§€ì› ê¸°ê¸°'); return; }
    
    gpsBtn.innerHTML = '<i class="ph-bold ph-spinner ph-spin"></i>';
    
    watchId = navigator.geolocation.watchPosition(
      pos=>{
        if(!tracking) {
             tracking=true; 
             gpsBtn.classList.add('active', 'tracking');
             gpsBtn.innerHTML = '<i class="ph-fill ph-navigation-arrow"></i>';
             toast('í˜„ì¬ ìœ„ì¹˜ ì¶”ì  ì¤‘');
        }
        
        const {latitude:lat, longitude:lng} = pos.coords;
        const el = document.createElement('div');
        el.style.cssText = 'width:18px;height:18px;border:3px solid #fff;background:#38bdf8;border-radius:50%;box-shadow:0 0 0 4px rgba(56,189,248,0.4)';
        const icon = L.divIcon({className:'', html:el, iconSize:[18,18], iconAnchor:[9,9]});
        
        if(me) me.setLatLng([lat,lng]); 
        else me = L.marker([lat,lng],{icon}).addTo(map).bindPopup('ğŸ“ ë‚´ ìœ„ì¹˜');
        
        map.flyTo([lat,lng], Math.max(map.getZoom(), 16), {duration:0.5});
      },
      err=>{ 
          tracking=false; 
          gpsBtn.innerHTML = '<i class="ph-bold ph-crosshair"></i>'; 
          toast('ìœ„ì¹˜ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”'); 
      },
      { enableHighAccuracy:true, maximumAge:5000, timeout:10000 }
    );
  });

  loadFacilities();
  addEventListener('resize', ()=> map.invalidateSize());
  </script>
</body>
</html>