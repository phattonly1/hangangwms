<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ë¬¸ì„œ ê²€ìƒ‰ (ë‹¤ì¤‘ í† ê¸€)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f9f9f9; color: #333; }
        h1 { text-align: center; color: #444; }
        #searchInput { width: 100%; padding: 15px; margin-bottom: 30px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        #searchInput:focus { border-color: #4CAF50; outline: none; }
        
        /* í† ê¸€ ìŠ¤íƒ€ì¼ */
        details { background-color: white; margin-bottom: 8px; border-radius: 8px; border: 1px solid #eee; overflow: hidden; }
        summary { padding: 12px 15px; cursor: pointer; font-weight: 600; background-color: #fff; list-style: none; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; }
        summary:hover { background-color: #f0f8ff; }
        summary::after { content: 'â–¼'; font-size: 12px; color: #999; transition: transform 0.3s; }
        details[open] > summary::after { transform: rotate(180deg); }
        
        /* ë‚´ìš© ë° í•˜ìœ„ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .content-box { padding: 15px; background-color: #fafafa; border-top: 1px solid #eee; line-height: 1.6; color: #555; }
        
        /* âœ¨ ë“¤ì—¬ì“°ê¸° í•µì‹¬ CSS: í•˜ìœ„ detailsëŠ” ì™¼ìª½ ì—¬ë°±ì„ ì¤Œ */
        .sub-list { border-top: 1px solid #eee; background-color: #fcfcfc; padding: 10px 0 10px 20px; } 
        
        .highlight { background-color: #fff176; font-weight: bold; border-radius: 2px; }
        #noResult { text-align: center; color: #888; margin-top: 20px; display: none; }
    </style>
</head>
<body>

    <h1>ğŸ—‚ï¸ ë‹¤ì¤‘ ê³„ì¸µ ë¬¸ì„œí•¨</h1>
    <input type="text" id="searchInput" placeholder="ì°¾ê³  ì‹¶ì€ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
    <div id="listContainer">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div id="noResult">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>

    <script>
        let docData = [];
        const listContainer = document.getElementById('listContainer');
        const noResult = document.getElementById('noResult');

        // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                docData = data;
                renderTree(); // ì´ˆê¸° ë Œë”ë§
            })
            .catch(error => {
                console.error('Error:', error);
                listContainer.innerHTML = 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ (Live Server í™•ì¸ í•„ìš”)';
            });

        // ê²€ìƒ‰ ì´ë²¤íŠ¸
        document.getElementById('searchInput').addEventListener('input', function() {
            renderTree(this.value.trim());
        });

        // âœ¨ í•µì‹¬: ì¬ê·€ì ìœ¼ë¡œ íŠ¸ë¦¬ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function buildTreeHTML(items, keyword) {
            let html = '';
            let hasMatchInLevel = false; // í˜„ì¬ ë ˆë²¨ì´ë‚˜ í•˜ìœ„ì— ë§¤ì¹­ë˜ëŠ” ê²Œ ìˆëŠ”ì§€

            items.forEach(item => {
                const lowerKeyword = keyword.toLowerCase();
                
                // 1. ë‚´ ì œëª©ì´ë‚˜ ë‚´ìš©ì´ ë§¤ì¹­ë˜ëŠ”ì§€ í™•ì¸
                const isTitleMatch = item.title.toLowerCase().includes(lowerKeyword);
                const isContentMatch = item.content && item.content.toLowerCase().includes(lowerKeyword);
                
                // 2. ìì‹ ìš”ì†Œ ì¬ê·€ í˜¸ì¶œ (í•˜ìœ„ ëª©ë¡ ë§Œë“¤ê¸°)
                let childrenResult = { html: '', hasMatch: false };
                if (item.children) {
                    childrenResult = buildTreeHTML(item.children, keyword);
                }

                // 3. ë³´ì—¬ì¤„ì§€ ê²°ì • (ê²€ìƒ‰ì–´ê°€ ì—†ê±°ë‚˜, ë‚´ê°€ ë§¤ì¹­ë˜ê±°ë‚˜, ìì‹ ì¤‘ì— ë§¤ì¹­ëœ ê²Œ ìˆì„ ë•Œ)
                if (keyword === '' || isTitleMatch || isContentMatch || childrenResult.hasMatch) {
                    hasMatchInLevel = true;
                    
                    // ê²€ìƒ‰ì–´ ê°•ì¡° (í•˜ì´ë¼ì´íŠ¸)
                    let displayTitle = keyword ? highlightText(item.title, keyword) : item.title;
                    
                    // ì—´ë¦¼ ìƒíƒœ ê²°ì •: ê²€ìƒ‰ì–´ê°€ ìˆê³  (í•˜ìœ„ê°€ ë§¤ì¹­ëê±°ë‚˜ ë‚´ê°€ ë§¤ì¹­ëì„ ë•Œ)
                    const isOpen = (keyword !== '' && (childrenResult.hasMatch || isTitleMatch || isContentMatch)) ? 'open' : '';

                    html += `<details ${isOpen}>`;
                    html += `<summary>${displayTitle}</summary>`;
                    
                    // ë‚´ìš©ì´ ìˆìœ¼ë©´ ì¶œë ¥
                    if (item.content) {
                        let displayContent = keyword ? highlightText(item.content, keyword) : item.content;
                        html += `<div class="content-box">${displayContent}</div>`;
                    }
                    
                    // ìì‹ì´ ìˆìœ¼ë©´ ì¶œë ¥ (ì¬ê·€ ê²°ê³¼ë¬¼ ì‚½ì…)
                    if (item.children) {
                        html += `<div class="sub-list">${childrenResult.html}</div>`;
                    }
                    
                    html += `</details>`;
                }
            });

            return { html, hasMatch: hasMatchInLevel };
        }

        // í™”ë©´ì— ê·¸ë¦¬ëŠ” ë©”ì¸ í•¨ìˆ˜
        function renderTree(keyword = '') {
            const result = buildTreeHTML(docData, keyword);
            listContainer.innerHTML = result.html;
            noResult.style.display = (result.html === '') ? 'block' : 'none';
        }

        function highlightText(text, keyword) {
            const regex = new RegExp(`(${keyword})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }
    </script>
</body>
</html>