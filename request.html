<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>요청 현황</title>
<link rel="icon" href="./assets/gongdan-mark.png" />
<style>
  :root{ --HDR-H:64px; --ink:#0b2239; --muted:#6b7280; --ring:rgba(0,119,255,.25); --card:#fff; --bd:#e5e7eb; }
  *{ box-sizing:border-box }
  html, body { height:100%; margin:0; font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Pretendard,Arial; color:var(--ink); }
  body { background:#f5f7fb; }

  /* 헤더 */
  .appbar{ height:var(--HDR-H); display:flex; align-items:center; gap:14px; padding:0 16px; background:#fff; border-bottom:1px solid rgba(0,0,0,.06); position:sticky; top:0; z-index:1000; }
  .logo-img{ width:44px; height:44px; object-fit:contain; filter:drop-shadow(0 2px 4px rgba(0,0,0,.12)); }
  .title-text{ min-width:0; }
  .title-text h1{ margin:0; font-weight:800; letter-spacing:-0.02em; line-height:1.1; font-size: clamp(18px, 4.2vw, 26px); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

  /* 본문 레이아웃 */
  .wrap{ max-width:1200px; margin:0 auto; padding:16px; }

  /* 툴바/필터 */
  .toolbar{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:8px 0 14px; }
  .btn{ appearance:none; border:0; cursor:pointer; padding:10px 14px; border-radius:10px; font-weight:700; background:#2563eb; color:#fff; box-shadow:0 6px 14px rgba(37,99,235,.2); }
  .btn.ghost{ background:#fff; color:#2563eb; border:1px solid #93c5fd; }
  .btn.danger{ background:#dc2626; color:#fff; }
  .muted{ color:var(--muted); font-size:13px; }
  .small{ font-size:12px; color:#64748b; }
  .filters{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 14px; }
  .input, .select{ padding:10px 12px; border:1px solid var(--bd); border-radius:10px; background:#fff; }
  .select{ min-width:140px; }
  .date{ min-width:160px; }

  /* 카드 + 테이블 */
  .card{ background:var(--card); border:1px solid var(--bd); border-radius:12px; overflow:auto; }
  table{ width:100%; border-collapse:collapse; }
  th, td{ border-bottom:1px solid var(--bd); padding:10px; text-align:left; white-space:nowrap; }
  th{ background:#f8fafc; font-weight:700; position:sticky; top:0; z-index:5; }
  tbody tr:hover{ background:#fafafa; }
  .right{ text-align:right; }
  .status-badge{ display:inline-block; padding:3px 8px; border-radius:999px; font-size:12px; background:#eef2ff; color:#3730a3; }
  .status-badge.pending{ background:#fff7ed; color:#9a3412; }
  .status-badge.done{ background:#ecfdf5; color:#065f46; }
  .chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:12px; }
  .chip.pending{ background:#fff7ed; color:#9a3412; }
  .chip.done{ background:#ecfdf5; color:#065f46; }

  .pagination{ display:flex; gap:8px; align-items:center; justify-content:flex-end; padding:10px 0; }
  .page-btn{ padding:8px 10px; border:1px solid var(--bd); background:#fff; border-radius:8px; cursor:pointer; }
  .error{ color:#b91c1c; font-size:13px; margin-top:10px; }

  /* 모바일 카드 뷰 */
  .cards{ display:none; }
  .card-item{ background:#fff; border:1px solid var(--bd); border-radius:12px; padding:12px; }
  .card-top{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:6px; }
  .card-title{ font-weight:800; }
  .card-sub{ color:#64748b; font-size:12px; }
  .card-mid{ margin:6px 0 10px; font-size:15px; }
  .card-actions{ display:flex; gap:6px; flex-wrap:wrap; align-items:center; }
  .card-actions .select{ min-width:120px; padding:8px 10px; }
  .card-actions .btn{ padding:8px 10px; }

  @media (max-width:640px){
    .card table{ display:none; }
    .cards{ display:grid; gap:10px; }
    .filters{ grid-template-columns:1fr 1fr; display:grid; }
    .filters .input, .filters .select{ width:100%; }
    .toolbar{ gap:8px; }
  }

  /* 저장 중 팝업 */
  .saving { position: fixed; inset: 0; background: rgba(0,0,0,.35); display: flex; align-items: center; justify-content: center; z-index: 3000; }
  .saving.hidden { display: none; }
  .saving .box { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 18px 20px; box-shadow: 0 10px 30px rgba(0,0,0,.2); font-weight: 700; }

  /* 토스트 */
  .toast{ position:fixed; right:16px; bottom:16px; background:rgba(0,0,0,.85); color:#fff; padding:10px 12px; border-radius:10px; opacity:0; pointer-events:none; transition:.25s; z-index:3000; }
  .toast.show{ opacity:1; }
</style>
</head>
<body>
  <!-- 헤더 -->
  <header class="appbar">
    <img class="logo-img" src="./assets/gongdan-mark.png" alt="공단 마크" />
    <div class="title-text"><h1>요청 현황</h1></div>
  </header>

  <!-- 본문 -->
  <main class="wrap">
    <!-- 상단 버튼 -->
    <div class="toolbar">
      <button class="btn" id="btnOpenAdd">추가하기</button>
      <button class="btn ghost" id="btnReload">새로고침</button>
      <button class="btn ghost" id="btnCSV">CSV 내보내기</button>
      <span class="muted small" id="summary">총 0건</span>
    </div>

    <!-- 요약 칩 -->
    <div class="toolbar" id="chips">
      <span class="chip">전체 <b id="c_all">0</b></span>
      <span class="chip pending">요청 <b id="c_req">0</b></span>
      <span class="chip">진행중 <b id="c_prog">0</b></span>
      <span class="chip done">완료 <b id="c_done">0</b></span>
    </div>

    <!-- 필터 -->
    <div class="filters">
      <input id="q" class="input" type="search" placeholder="검색(요청자/물품)" aria-label="검색" />
      <select id="f_status" class="select" aria-label="진행상태">
        <option value="">진행상태(전체)</option>
        <option>요청</option><option>진행중</option><option>완료</option>
      </select>
      <input id="f_from" class="input date" type="date" aria-label="시작일" />
      <input id="f_to" class="input date" type="date" aria-label="종료일" />
      <select id="f_pagesize" class="select" aria-label="페이지 크기">
        <option value="10">10행</option><option value="20">20행</option><option value="50">50행</option><option value="100">100행</option>
      </select>
      <span class="muted small">열 머리 클릭 → 정렬</span>
    </div>

    <!-- 테이블 -->
    <div class="card" role="region" aria-label="요청 현황 표">
      <table id="tbl">
        <thead>
          <tr>
            <th data-k="ID" style="width:70px">ID</th>
            <th data-k="요청일">요청일</th>
            <th data-k="요청자">요청자</th>
            <th data-k="요청물품">요청물품</th>
            <th data-k="개수" class="right" style="width:90px">개수</th>
            <th data-k="진행사항" style="width:140px">진행상태</th>
            <th style="width:160px">빠른변경</th>
            <th style="width:90px">수정</th>
            <th style="width:90px">삭제</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="9">불러오는 중...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- 모바일 카드 리스트 -->
    <div id="cards" class="cards" aria-live="polite"></div>

    <!-- 페이지네이션 -->
    <div class="pagination">
      <button class="page-btn" id="prev" aria-label="이전 페이지">이전</button>
      <span class="small" id="pageinfo">0 / 0</span>
      <button class="page-btn" id="next" aria-label="다음 페이지">다음</button>
    </div>

    <div id="msg" class="error" role="alert"></div>
  </main>

  <!-- 추가/수정 모달 -->
  <div class="modal" id="modal" aria-modal="true" role="dialog" aria-labelledby="modalTitle">
    <div class="panel">
      <h3 id="modalTitle" style="margin:0 0 10px">요청 추가</h3>
      <form id="postForm" method="POST" target="hidden_iframe">
        <input type="hidden" name="op" value="add" />
        <input type="hidden" name="id" value="" />
        <div class="grid">
          <div class="field">
            <label for="f_date">요청일</label>
            <input id="f_date" type="date" name="date" required />
          </div>
          <div class="field">
            <label for="f_who">요청자</label>
            <input id="f_who" type="text" name="who" placeholder="차영종" required />
          </div>
          <div class="field">
            <label for="f_item">요청물품</label>
            <input id="f_item" type="text" name="item" placeholder="TOC연소관" required />
          </div>
          <div class="field">
            <label for="f_qty">개수</label>
            <input id="f_qty" type="number" name="qty" min="1" step="1" required />
          </div>
          <div class="field">
            <label for="f_status2">진행상태</label>
            <select id="f_status2" name="status" required>
              <option value="요청">요청</option>
              <option value="진행중">진행중</option>
              <option value="완료">완료</option>
            </select>
          </div>
        </div>
        <div class="actions">
          <button type="button" class="btn ghost" id="btnCancel">취소</button>
          <button type="submit" class="btn" id="btnSubmit">저장</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 숨은 iframe: 폼 POST 응답 수신 -->
  <iframe name="hidden_iframe" id="hidden_iframe" style="display:none"></iframe>

  <!-- 숨은 액션 폼(재사용) : 빠른변경/삭제용 -->
  <form id="actionForm" method="POST" target="hidden_iframe" style="display:none">
    <input type="hidden" name="op" />
    <input type="hidden" name="id" />
    <input type="hidden" name="status" />
  </form>

  <!-- 저장 중 팝업 -->
  <div id="savingPopup" class="saving hidden" aria-live="polite">
    <div class="box">요청을 저장 중입니다…</div>
  </div>

  <!-- 토스트 -->
  <div class="toast" id="toast" role="status">처리되었습니다.</div>

  <script>
    /* === 설정 === */
    const SHEET_ID = "13-0Qp2ImIIURJqv-YbklEVbsNYLPz_akDRwO2lDeEvM";
    const GID = "0";
    const APPS_SCRIPT_EXEC = "https://script.google.com/macros/s/AKfycbzsMVRPSrtbERnCK5nj9NiYNqVXxLsZBSQE5YmCJlxGlx4jeuDdrP7IpEcikGpyDlk6/exec";

    /* === 상태/유틸 === */
    let raw = [], view = [];
    let page = 1, pageSize = 10;
    let sortKey = "ID", sortDir = "desc";
    let isSubmitting = false;
    const $ = s => document.querySelector(s);
    const toast = (t)=>{ const el=$('#toast'); el.textContent=t; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), 1600); };
    const normDate = (v)=>{ if(!v) return ''; if(/^\d{4}-\d{2}-\d{2}$/.test(v)) return v; return String(v).replace(/[.\s]/g,'-').replace(/-$/,'').replace(/--/g,'-'); };
    const toNum = v => (v===''||v==null||isNaN(Number(v))) ? 0 : Number(v);
    const sel = (cur, val)=> (String(cur||'').trim()===val ? 'selected' : '');

    function statusBadge(v){
      const t = (v||'').trim();
      if (t==='완료') return '<span class="status-badge done">완료</span>';
      if (t==='요청') return '<span class="status-badge pending">요청</span>';
      if (t) return `<span class="status-badge">${t}</span>`;
      return '';
    }

    /* === 데이터 로드(GViz JSONP) === */
    function load(){
      const old = document.getElementById('gviz'); if (old) old.remove();
      $('#tbody').innerHTML = '<tr><td colspan="9">불러오는 중...</td></tr>';
      $('#cards').innerHTML = '';
      $('#msg').textContent = '';
      const s = document.createElement('script'); s.id='gviz';
      s.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json;responseHandler:renderGViz&_=${Date.now()}`;
      s.onerror = () => { $('#msg').textContent = '시트 로드 실패: URL/권한을 확인하세요.'; };
      document.body.appendChild(s);
    }

    window.renderGViz = function(resp){
      try{
        if (!resp || resp.status==='error' || !resp.table){
          $('#msg').textContent = '표시 실패: 시트 권한/머리글/GID를 확인하세요.';
          return;
        }
        const table = resp.table;
        const cols = table.cols.map(c=>c?.label||'');
        const rows = (table.rows||[]).map(r => (r?.c||[]).map(c => c? c.v : ''));
        const idx = {
          id:   cols.indexOf("ID"),
          date: cols.indexOf("요청일"),
          who:  cols.indexOf("요청자"),
          item: cols.indexOf("요청물품"),
          qty:  cols.indexOf("개수"),
          stat: cols.indexOf("진행사항")
        };
        raw = rows.map(r => ({
          ID: r[idx.id], 요청일: r[idx.date], 요청자: r[idx.who], 요청물품: r[idx.item], 개수: r[idx.qty], 진행사항: r[idx.stat]
        })).filter(r=> r.ID!=='' && r.ID!=null);
        applyAndRender();
      }catch(e){ $('#msg').textContent = '표시 실패: ' + e.message; }
    };

    /* === 필터/정렬/페이지 + 렌더 === */
    function applyAndRender(){
      // 필터
      const q = $('#q').value.trim().toLowerCase();
      const fs = $('#f_status').value.trim();
      const ffrom = $('#f_from').value ? new Date($('#f_from').value) : null;
      const fto   = $('#f_to').value ? new Date($('#f_to').value) : null;

      view = raw.filter(r=>{
        const textOk = !q || (String(r['요청자']).toLowerCase().includes(q) || String(r['요청물품']).toLowerCase().includes(q));
        const statOk = !fs || String(r['진행사항']).trim()===fs;
        let dateOk = true;
        if (ffrom || fto) {
          const d = new Date(normDate(r['요청일']));
          if (ffrom && d < ffrom) dateOk = false;
          if (fto) { const end = new Date(fto); end.setHours(23,59,59,999); if (d > end) dateOk = false; }
        }
        return textOk && statOk && dateOk;
      });

      // 요약
      const all=view.length, req=view.filter(x=>String(x['진행사항']).trim()==='요청').length, prog=view.filter(x=>String(x['진행사항']).trim()==='진행중').length, done=view.filter(x=>String(x['진행사항']).trim()==='완료').length;
      $('#c_all').textContent=all; $('#c_req').textContent=req; $('#c_prog').textContent=prog; $('#c_done').textContent=done;
      $('#summary').textContent = `총 ${all}건`;

      // 정렬
      view.sort((a,b)=>{
        const A=a[sortKey], B=b[sortKey]; let cmp=0;
        if (sortKey==='개수' || sortKey==='ID') cmp = toNum(A)-toNum(B);
        else if (sortKey==='요청일') cmp = new Date(normDate(A)) - new Date(normDate(B));
        else cmp = String(A||'').localeCompare(String(B||''), 'ko');
        return (sortDir==='asc') ? cmp : -cmp;
      });

      // 페이지
      pageSize = Number($('#f_pagesize').value)||10;
      const totalPages = Math.max(1, Math.ceil(view.length/pageSize));
      if (page>totalPages) page=totalPages;
      const slice = view.slice((page-1)*pageSize, (page-1)*pageSize + pageSize);
      $('#pageinfo').textContent = `${page} / ${totalPages}`;

      // 표 렌더
      const tbody = $('#tbody');
      if (!slice.length){ tbody.innerHTML = '<tr><td colspan="9">데이터가 없습니다.</td></tr>'; $('#cards').innerHTML=''; return; }
      const frag = document.createDocumentFragment();
      slice.forEach(row=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.ID??''}</td>
          <td>${row['요청일']??''}</td>
          <td>${row['요청자']??''}</td>
          <td>${row['요청물품']??''}</td>
          <td class="right">${row['개수']??''}</td>
          <td>${statusBadge(row['진행사항'])}</td>
          <td>
            <select data-quick="${row.ID}" class="select" style="min-width:120px;padding:6px 8px;">
              <option ${sel(row['진행사항'],'요청')}>요청</option>
              <option ${sel(row['진행사항'],'진행중')}>진행중</option>
              <option ${sel(row['진행사항'],'완료')}>완료</option>
            </select>
            <button class="btn ghost" style="padding:6px 10px;margin-left:6px" data-save="${row.ID}">변경</button>
          </td>
          <td><button class="btn" style="padding:6px 10px" data-edit="${row.ID}">수정</button></td>
          <td><button class="btn danger" style="padding:6px 10px" data-del="${row.ID}">삭제</button></td>
        `;
        frag.appendChild(tr);
      });
      tbody.innerHTML = '';
      tbody.appendChild(frag);

      // 모바일 카드 렌더
      const cards = document.getElementById('cards');
      if (cards){
        const cfrag = document.createDocumentFragment();
        slice.forEach(row=>{
          const wrap = document.createElement('div');
          wrap.className = 'card-item';
          wrap.innerHTML = `
            <div class="card-top">
              <div class="card-title">#${row.ID ?? ''}</div>
              <div class="card-sub">${row['요청일'] ?? ''}</div>
            </div>
            <div class="card-mid">
              <div><b>요청물품</b> · ${row['요청물품'] ?? ''}</div>
              <div class="small">요청자: ${row['요청자'] ?? ''} · 개수: ${row['개수'] ?? ''}</div>
            </div>
            <div class="card-actions">
              <span>${statusBadge(row['진행사항'])}</span>
              <select data-quick-m="${row.ID}" class="select">
                <option ${sel(row['진행사항'],'요청')}>요청</option>
                <option ${sel(row['진행사항'],'진행중')}>진행중</option>
                <option ${sel(row['진행사항'],'완료')}>완료</option>
              </select>
              <button class="btn ghost" data-save-m="${row.ID}">변경</button>
              <button class="btn" data-edit-m="${row.ID}">수정</button>
              <button class="btn danger" data-del-m="${row.ID}">삭제</button>
            </div>
          `;
          cfrag.appendChild(wrap);
        });
        cards.innerHTML = '';
        cards.appendChild(cfrag);

        // 카드 핸들러
        cards.querySelectorAll('button[data-save-m]').forEach(btn=>{
          btn.onclick = ()=>{
            const id = btn.getAttribute('data-save-m');
            const selEl = cards.querySelector(`select[data-quick-m="${id}"]`);
            quickUpdate(id, selEl.value);
          };
        });
        cards.querySelectorAll('button[data-edit-m]').forEach(btn=>{
          btn.onclick = ()=>{
            const id = btn.getAttribute('data-edit-m');
            const full = raw.find(r=>String(r.ID)===String(id));
            if (full) openModal('update', full);
          };
        });
        cards.querySelectorAll('button[data-del-m]').forEach(btn=>{
          btn.onclick = ()=>{
            const id = btn.getAttribute('data-del-m');
            if (confirm(`ID ${id} 항목을 삭제할까요? (되돌릴 수 없음)`)) quickDelete(id);
          };
        });
      }

      // 핸들러(테이블)
      tbody.querySelectorAll('button[data-save]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-save');
          const selEl = tbody.querySelector(`select[data-quick="${id}"]`);
          quickUpdate(id, selEl.value);
        };
      });
      tbody.querySelectorAll('button[data-edit]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-edit');
          const full = raw.find(r=>String(r.ID)===String(id));
          if (full) openModal('update', full);
        };
      });
      tbody.querySelectorAll('button[data-del]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-del');
          if (confirm(`ID ${id} 항목을 삭제할까요? (되돌릴 수 없음)`)) quickDelete(id);
        };
      });
    }

    /* === 이벤트 === */
    $('#btnReload').onclick = load;
    $('#btnOpenAdd').onclick = ()=> openModal('add');
    $('#btnCancel').onclick  = closeModal;
    $('#prev').onclick = ()=>{ if(page>1){ page--; applyAndRender(); } };
    $('#next').onclick = ()=>{ page++; applyAndRender(); };
    $('#f_pagesize').onchange = ()=>{ page=1; applyAndRender(); };

    // 필터 디바운스
    let tmr;
    ['q','f_status','f_from','f_to'].forEach(id=>{
      $('#'+id).addEventListener('input', ()=>{ clearTimeout(tmr); tmr=setTimeout(()=>{ page=1; applyAndRender(); }, 220); });
      $('#'+id).addEventListener('change', ()=>{ page=1; applyAndRender(); });
    });

    // 정렬
    document.querySelectorAll('th[data-k]').forEach(th=>{
      th.style.cursor='pointer';
      th.onclick = ()=>{
        const k = th.getAttribute('data-k');
        if (sortKey===k) sortDir = (sortDir==='asc'?'desc':'asc');
        else { sortKey=k; sortDir='asc'; }
        applyAndRender();
      };
    });

    // CSV
    $('#btnCSV').onclick = ()=>{
      const header = ['ID','요청일','요청자','요청물품','개수','진행상태'];
      const rows = view.map(r => [r.ID, r['요청일'], r['요청자'], r['요청물품'], r['개수'], r['진행사항']]);
      const csv = [header].concat(rows).map(a=>a.map(x=>`"${String(x??'').replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `requests_${new Date().toISOString().slice(0,10)}.csv`; a.click();
      URL.revokeObjectURL(url);
    };

    /* === 모달/폼 & 저장 중 팝업 === */
    const modalEl = $('#modal'); const form = $('#postForm');
    const hiddenIframe = document.getElementById('hidden_iframe');
    const savingEl = $('#savingPopup'); const btnSubmit = $('#btnSubmit');

    function openModal(mode, row) {
      modalEl.classList.add('show');
      form.action = APPS_SCRIPT_EXEC;
      if (mode==='add'){
        $('#modalTitle').textContent = '요청 추가';
        form.op.value='add'; form.id.value='';
        form.date.value=''; form.who.value=''; form.item.value=''; form.qty.value=''; form.status.value='요청';
      } else {
        $('#modalTitle').textContent = '요청 수정';
        form.op.value='update'; form.id.value=row.ID;
        form.date.value = normDate(row['요청일']); form.who.value=row['요청자']||''; form.item.value=row['요청물품']||''; form.qty.value=row['개수']||''; form.status.value=(row['진행사항']||'요청');
      }
    }
    function closeModal(){ modalEl.classList.remove('show'); }

    // 중복 제출 방지 + 저장중 팝업
    form.addEventListener('submit', (e) => {
      if (isSubmitting) { e.preventDefault(); return; }
      isSubmitting = true;
      btnSubmit.disabled = true;
      btnSubmit.textContent = '저장 중…';
      form.querySelectorAll('input, select, button').forEach(el => el.disabled = true);
      savingEl.classList.remove('hidden');
    });

    // 숨은 iframe 응답 판독 (OK/ERROR:)
    hiddenIframe.addEventListener('load', () => {
      let text = '';
      try {
        const doc = hiddenIframe.contentDocument || hiddenIframe.contentWindow.document;
        text = (doc && doc.body) ? (doc.body.textContent || doc.body.innerText || '') : '';
      } catch (e) { /* cross-origin 안전가드 */ }

      // 공통 해제
      isSubmitting = false;
      btnSubmit.disabled = false;
      btnSubmit.textContent = '저장';
      form.querySelectorAll('input, select, button').forEach(el => el.disabled = false);
      savingEl.classList.add('hidden');

      if (text && text.startsWith('ERROR:')) {
        toast('실패: ' + text.replace('ERROR:','').trim());
        return; // 실패면 모달 유지 (수정 가능)
      }

      // 성공 처리
      closeModal();
      toast('처리되었습니다');
      load();
    });

    // 빠른 상태 변경 / 삭제: 숨은 액션 폼 재사용
    const actionForm = document.getElementById('actionForm');
    actionForm.action = APPS_SCRIPT_EXEC;

    function submitAction(op, id, status){
      actionForm.op.value = op;
      actionForm.id.value = id;
      actionForm.status.value = status || '';
      actionForm.submit();
    }

    function quickUpdate(id, status){
      submitAction('update', id, status);
      toast('상태 변경 중…');
    }

    function quickDelete(id){
      submitAction('delete', id);
      toast('삭제 중…');
    }

    /* === 초기화 === */
    load();
  </script>
</body>
</html>
